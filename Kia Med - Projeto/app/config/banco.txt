
/* ESSE CÓDIGO SERÁ DESTINADO NA CRIAÇÃO DO BANCO DE DADOS DO KIAMED, UM SITE DESTINADO A ASSUNTOS SOBRE SAÚDE PSICOLÓGICA E AFINS */

CREATE DATABASE IF NOT EXISTS Kiamed;
USE Kiamed;

/* TABELA DO ADMIN */
CREATE TABLE IF NOT EXISTS ADMIN (
    cod_admin INT NOT NULL AUTO_INCREMENT,
    nome VARCHAR(60) NOT NULL,
    data_cadastro DATE, 
    email VARCHAR(45) NOT NULL, 
    telefone VARCHAR(13) NOT NULL,
    PRIMARY KEY(cod_admin),
    senha VARCHAR(255) NOT NULL
);



/* TABELA DO USUÁRIO */
CREATE TABLE IF NOT EXISTS USUARIO (
    cod_usuario INT NOT NULL AUTO_INCREMENT,
    nome VARCHAR(60) NOT NULL,
    data_cadastro DATE, 
    email VARCHAR(45) NOT NULL,
    PRIMARY KEY (cod_usuario),
    senha VARCHAR(255) NOT NULL
);

CREATE TABLE IF NOT EXISTS FEEDBACK (
    cod_feedback INT NOT NULL AUTO_INCREMENT,
    texto_feedback TEXT NOT NULL,
    data_feedback DATE NOT NULL,
    cod_usuario INT NOT NULL,
    PRIMARY KEY (cod_feedback),
    FOREIGN KEY (cod_usuario) REFERENCES USUARIO(cod_usuario) ON DELETE CASCADE ON UPDATE CASCADE
);



/* ARMAZENAMENTO DE COMENTÁRIOS DOS USUÁRIOS COM O POST */
CREATE TABLE IF NOT EXISTS COMENTARIO (
    cod_comentario INT NOT NULL AUTO_INCREMENT,
    texto_comentario VARCHAR(120) NOT NULL,
    data_comentario DATE NOT NULL,
    cod_usuario INT,
    PRIMARY KEY(cod_comentario),
    FOREIGN KEY (cod_usuario) REFERENCES USUARIO(cod_usuario)
);

/* RELAÇÃO ADMIN COM COMENTARIO, ANÁLISE SEU COMENTÁRIO É OK OU NÃO PARA O SITE */
CREATE TABLE IF NOT EXISTS SUPERVISAO (
    PK_SUPERADMIN INT NOT NULL AUTO_INCREMENT,
    cod_comentario INT,
    cod_admin INT,
    PRIMARY KEY (PK_SUPERADMIN),
    FOREIGN KEY (cod_comentario) REFERENCES COMENTARIO(cod_comentario),
    FOREIGN KEY (cod_admin) REFERENCES ADMIN(cod_admin)
);

/* TABELA RESPONSÁVEL PARA ARMAZENAR O CONTEÚDO EM GERAL */
CREATE TABLE IF NOT EXISTS CONTEUDO (
    cod_conteudo INT NOT NULL AUTO_INCREMENT, 
    hiperlink VARCHAR(50) NOT NULL,
    texto VARCHAR(255) NOT NULL,
    data_insercao DATE NOT NULL,
    PRIMARY KEY (cod_conteudo)
);

/* TABELA QUE IRÁ ARMAZENAR IMAGENS, VÍDEOS, DOCUMENTOS, E DADOS EM GERAL DOS CONTEÚDOS */
CREATE TABLE IF NOT EXISTS ANEXOS (
    cod_img INT NOT NULL AUTO_INCREMENT,
    evento VARCHAR(50) NOT NULL,
    descricao VARCHAR(255) NOT NULL,
    nome_imagem VARCHAR(25) NOT NULL,
    tamanho_imagem VARCHAR(25) NOT NULL,
    tipo_imagem VARCHAR(25) NOT NULL,
    anexo LONGBLOB NOT NULL,
    cod_conteudo INT,
    PRIMARY KEY (cod_img),
    FOREIGN KEY (cod_conteudo) REFERENCES CONTEUDO(cod_conteudo)
);

/* TABELA DE RELAÇÃO ENTRE ADMIN E CONTEÚDO (APENAS ADMIN ADICIONA CONTEÚDOS NO SITE) */
CREATE TABLE IF NOT EXISTS ADICAO (
    PK_CONTEUDO INT NOT NULL AUTO_INCREMENT,
    cod_admin INT,
    cod_conteudo INT,
    PRIMARY KEY (PK_CONTEUDO),
    FOREIGN KEY (cod_admin) REFERENCES ADMIN(cod_admin),
    FOREIGN KEY (cod_conteudo) REFERENCES CONTEUDO(cod_conteudo)
);

/* TABELA CATEGORIA RESPONSÁVEL POR ARMAZENAR DE ACORDO COM SEU TIPO OS CONTEÚDOS POSTADOS */
CREATE TABLE IF NOT EXISTS CATEGORIA (
    cod_categoria INT NOT NULL AUTO_INCREMENT,
    tipo_categoria VARCHAR(20) NOT NULL,
    PRIMARY KEY (cod_categoria)
);

/* TABELA DE RELAÇÃO ENTRE CATEGORIA E CONTEÚDO */
CREATE TABLE IF NOT EXISTS CATCONT (
    PK_CATEGORIA_CONTEUDO INT NOT NULL AUTO_INCREMENT,
    cod_conteudo INT,
    cod_categoria INT,
    PRIMARY KEY (PK_CATEGORIA_CONTEUDO),
    FOREIGN KEY (cod_conteudo) REFERENCES CONTEUDO(cod_conteudo),
    FOREIGN KEY (cod_categoria) REFERENCES CATEGORIA(cod_categoria)
);

------ parte eduardo -------

CREATE TABLE categorias (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(255) NOT NULL
);

CREATE TABLE posts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    titulo VARCHAR(255) NOT NULL,
    descricao TEXT NOT NULL,
    conteudo TEXT NOT NULL,
    imagem VARCHAR(255),
    categoria_id INT,
    FOREIGN KEY (categoria_id) REFERENCES categorias(id)
);


ALTER TABLE COMENTARIO ADD COLUMN cod_post INT;
ALTER TABLE COMENTARIO ADD FOREIGN KEY (cod_post) REFERENCES posts(id);



-- Inserir categorias de exemplo na tabela 'categorias'
INSERT INTO categorias (nome) VALUES 
('Depressão'),
('Ansiedade'),
('Terapia Cognitivo-Comportamental'),
('Mindfulness'),
('Autoajuda'),
('Relacionamentos'),
('Bem-estar'),
('Meditação'),
('Saúde Mental'),
('Estresse');
